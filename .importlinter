# Import Linter Configuration (CONST-10)
# Enforces architectural boundaries per Constitution Section 15
# Updated: 2026-01-23 - Diamond-Level Architecture improvements

[importlinter]
root_package = backend

[importlinter:contract:1]
name = Core module has no dependencies on business modules
type = forbidden
source_modules =
    modules.core
forbidden_modules =
    modules.clients
    modules.crm
    modules.projects
    modules.finance
    modules.documents
    modules.calendar
    modules.marketing
    modules.pricing
    modules.delivery
    modules.orchestration
    modules.recurrence
    modules.onboarding
    modules.knowledge
    modules.communications
    modules.email_ingestion
    modules.support
    modules.sms
    modules.snippets
    modules.auth
    modules.jobs
    modules.assets

[importlinter:contract:2]
name = Firm module is foundation - business modules may not import each other directly
type = forbidden
source_modules =
    modules.firm
forbidden_modules =
    modules.clients
    modules.crm
    modules.projects
    modules.finance
    modules.documents
    modules.calendar
    modules.marketing
    modules.pricing
    modules.delivery
    modules.orchestration
    modules.recurrence
    modules.onboarding
    modules.knowledge
    modules.communications
    modules.email_ingestion
    modules.support
    modules.sms
    modules.snippets
    modules.auth
    modules.jobs
    modules.assets

[importlinter:contract:3]
name = Portal API must not import staff admin modules
type = forbidden
source_modules =
    api.portal
forbidden_modules =
    modules.firm.admin

[importlinter:contract:4]
name = API layer must not import infrastructure directly (async tasks, signals)
type = forbidden
source_modules =
    api
forbidden_modules =
    modules.*.tasks
    modules.*.signals
    celery

[importlinter:contract:5]
name = Portal API must not import staff-only modules
type = forbidden
source_modules =
    api.portal
forbidden_modules =
    api.crm
    api.finance
    api.projects
    api.documents
    api.clients
    api.assets

[importlinter:contract:6]
name = API modules should not import from each other (avoid coupling)
type = forbidden
source_modules =
    api.crm
    api.finance
    api.projects
    api.documents
    api.clients
    api.assets
    api.webhooks
forbidden_modules =
    api.crm
    api.finance
    api.projects
    api.documents
    api.clients
    api.assets
    api.webhooks
    api.portal

[importlinter:contract:7]
name = Events module is foundational - only publishes, never subscribes to domain modules
type = forbidden
source_modules =
    modules.events
forbidden_modules =
    modules.clients
    modules.crm
    modules.projects
    modules.finance
    modules.documents

# Architectural Guidelines (Updated 2026-01-23 for Diamond-Level):
# 
# 1. Layer hierarchy (top can import from bottom):
#    Layer 0 (Foundation): modules.firm, modules.core
#    Layer 1 (Infrastructure): modules.events (domain events)
#    Layer 2 (Domain Modules): modules.crm, modules.clients, modules.projects, etc.
#    Layer 3 (API): api.* (ViewSets, serializers)
# 
# 2. Foundation modules (everyone can depend on these):
#    - modules.firm: Firm/tenant foundation
#    - modules.core: Shared utilities
#    - modules.events: Domain events infrastructure
# 
# 3. Cross-module communication:
#    - Domain modules MUST communicate via events (modules.events)
#    - Direct imports between domain modules are FORBIDDEN
#    - Use @subscribe_to decorator in event_handlers.py
# 
# 4. Portal isolation:
#    - Portal API has restricted access
#    - Cannot import admin-only code or staff API modules
# 
# 5. API isolation:
#    - API modules MUST NOT import from each other
#    - Prevents tight coupling between API endpoints
# 
# 6. Event-driven architecture:
#    - modules.events is Layer 1 (foundation)
#    - Domain modules publish events, subscribe to events
#    - Events break circular dependencies
