# Import Linter Configuration (CONST-10)
# Enforces architectural boundaries per Constitution Section 15

[importlinter]
root_package = src

[importlinter:contract:1]
name = Core module has no dependencies on business modules
type = forbidden
source_modules =
    src.modules.core
forbidden_modules =
    src.modules.clients
    src.modules.crm
    src.modules.projects
    src.modules.finance
    src.modules.documents
    src.modules.calendar
    src.modules.marketing
    src.modules.pricing
    src.modules.delivery
    src.modules.orchestration
    src.modules.recurrence
    src.modules.onboarding
    src.modules.knowledge
    src.modules.communications
    src.modules.email_ingestion
    src.modules.support
    src.modules.sms
    src.modules.snippets
    src.modules.auth
    src.modules.jobs
    src.modules.assets

[importlinter:contract:2]
name = Firm module is foundation - business modules may not import each other directly
type = forbidden
source_modules =
    src.modules.firm
forbidden_modules =
    src.modules.clients
    src.modules.crm
    src.modules.projects
    src.modules.finance
    src.modules.documents
    src.modules.calendar
    src.modules.marketing
    src.modules.pricing
    src.modules.delivery
    src.modules.orchestration
    src.modules.recurrence
    src.modules.onboarding
    src.modules.knowledge
    src.modules.communications
    src.modules.email_ingestion
    src.modules.support
    src.modules.sms
    src.modules.snippets
    src.modules.auth
    src.modules.jobs
    src.modules.assets

[importlinter:contract:3]
name = Portal API must not import staff admin modules
type = forbidden
source_modules =
    src.api.portal
forbidden_modules =
    src.modules.firm.admin

[importlinter:contract:4]
name = API modules should not import from each other (avoid coupling) - Portal
name = API layer must not import infrastructure directly (async tasks, signals)
type = forbidden
source_modules =
    src.api
forbidden_modules =
    src.modules.*.tasks
    src.modules.*.signals
    celery

[importlinter:contract:2]
name = Domain/service layer must not import Django ORM directly
type = forbidden
source_modules =
    src.modules.*.services
    src.modules.*.domain
forbidden_modules =
    django.db.models.query
ignore_imports =
    django.db.transaction -> *

[importlinter:contract:3]
name = No circular dependencies between core modules
type = independence
modules =
    src.modules.crm
    src.modules.finance
    src.modules.projects
    src.modules.documents
    src.modules.clients
    src.modules.calendar

[importlinter:contract:4]
name = Portal API must not import staff-only modules
type = forbidden
source_modules =
    src.api.portal
forbidden_modules =
    src.api.crm
    src.api.finance
    src.api.projects
    src.api.documents
    src.api.clients
    src.api.assets

[importlinter:contract:5]
name = API modules should not import from each other (avoid coupling) - CRM
type = forbidden
source_modules =
    src.api.crm
forbidden_modules =
    src.api.portal
    src.api.finance
    src.api.projects
    src.api.documents
    src.api.clients
    src.api.assets

# Architectural Guidelines:
# 
# 1. Layer hierarchy (top can import from bottom):
#    - API Layer (api/*) - ViewSets, serializers
#    - Business Logic (modules/*) - Models, services
#    - Infrastructure (config/*) - Settings, middleware
# 
# 2. Foundation modules (everyone can depend on these):
#    - src.modules.firm - Firm/tenant foundation
#    - src.modules.core - Shared utilities
# 
# 3. Cross-module dependencies:
#    - Business modules should communicate via services, not direct imports
#    - Use events/signals for cross-module communication when possible
# 
# 4. Portal isolation:
#    - Portal API has restricted access
#    - Cannot import admin-only code
# 
# 5. API isolation:
#    - API modules should not import from each other
#    - Prevents tight coupling between API endpoints

    src.modules.firm.provisioning
    src.modules.firm.admin

[importlinter:contract:5]
name = Infrastructure must not import domain logic
type = layers
layers =
    src.modules.*.views
    src.modules.*.serializers
    src.modules.*.services
    src.modules.*.models
